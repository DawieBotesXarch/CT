version: "3.8"

# ============================================
# WHEN COPYING TO A NEW PROJECT:
# 1. Change "openmemory-ct2" to "openmemory-YOURPROJECT" (line 17, 64)
# 2. Change external port "8080" to unique port (line 20 - LEFT side only!)
# 3. DO NOT change internal port ":8080" or OM_PORT (always 8080)
# See COPY-TO-NEW-PROJECT.md for details
# ============================================

services:
  openmemory:
    # Building from local source since image pull is denied
    build:
      context: ./temp-build/backend
      dockerfile: Dockerfile

    # If you have access to the registry, you can uncomment this instead:
    # image: ghcr.io/caviraoss/openmemory:latest

    container_name: openmemory-ct2  # CHANGE THIS for new projects
    restart: unless-stopped
    ports:
      - "8080:8080"  # CHANGE LEFT number only for new projects! Right must stay 8080
    volumes:
      - ./data:/data
    environment:
      # Core Configuration
      - OM_PORT=8080  # DO NOT CHANGE - Always 8080 (internal port)
      - OM_MODE=standard
      - OM_TIER=hybrid
      - OM_DB_PATH=/data/openmemory.sqlite

      # Embeddings Configuration
      - OM_EMBEDDINGS=synthetic  # Options: synthetic, openai, gemini, ollama
      - OM_EMBEDDING_FALLBACK=synthetic
      - OM_EMBED_MODE=simple
      - OM_VEC_DIM=256

      # Optional: API Key Protection
      # - OM_API_KEY=your-secret-key

      # Optional: OpenAI Configuration (if OM_EMBEDDINGS=openai)
      # - OPENAI_API_KEY=sk-xxx
      # - OM_OPENAI_BASE_URL=https://api.openai.com/v1

      # Optional: Gemini Configuration (if OM_EMBEDDINGS=gemini)
      # - GEMINI_API_KEY=xxx

      # Optional: Ollama Configuration (if OM_EMBEDDINGS=ollama)
      # - OLLAMA_URL=http://localhost:11434

      # Memory & Search Settings
      - OM_MIN_SCORE=0.3
      - OM_MAX_PAYLOAD_SIZE=1000000

    healthcheck:
      test: ['CMD-SHELL', 'node -e "require(''http'').get(''http://localhost:8080/health'', (res) => process.exit(res.statusCode === 200 ? 0 : 1)).on(''error'', () => process.exit(1))"']
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

networks:
  default:
    name: openmemory-ct2-network  # CHANGE THIS for new projects
